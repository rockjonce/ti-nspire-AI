<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TI-Nspire æ•¸å­¸å¯¦é©—å®¤</title>
<style>
  body { 
    font-family: "Times New Roman", "Microsoft JhengHei", serif; 
    margin: 0; padding: 0; 
    background-color: #f0f2f5;
    display: flex; flex-direction: column; 
    align-items: center; justify-content: center;
    height: 100vh;
    overflow: hidden;
  }

  /* ğŸŸ¢ ä¸»è¦å®¹å™¨ ğŸŸ¢ */
  .main-card {
      background: white;
      width: 90%; max-width: 650px;
      padding: 35px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      text-align: center;
      transition: all 0.3s ease;
      border-top: 5px solid #003366; /* å­¸è¡“æ·±è— */
  }

  h2 { margin-top: 0; color: #003366; margin-bottom: 15px; font-weight: bold; letter-spacing: 1px;}
  p.desc { color: #555; font-size: 15px; margin-bottom: 30px; line-height: 1.6;}

  /* é è¦½å€ */
  #preview-area { 
    display: none; padding: 15px; background: #fff; 
    border-radius: 6px; margin-bottom: 20px; position: relative;
    align-items: center; gap: 15px; border: 1px solid #ddd;
    justify-content: center;
  }
  
  #preview-img { height: 80px; border: 1px solid #eee; display: none;}
  #preview-pdf { 
      display: none; height: 60px; width: 60px; background: #b30000; color: white;
      border-radius: 4px; text-align: center; line-height: 60px; font-weight: bold; font-size: 14px;
  }

  #file-name-preview { font-size: 14px; color: #333; font-family: monospace; max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

  #remove-img-btn {
    position: absolute; top: -10px; right: -10px;
    background: #cc0000; color: white;
    border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;
    font-size: 14px; line-height: 24px; text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  /* è¼¸å…¥æ§åˆ¶å€ */
  .input-group { display: flex; gap: 10px; align-items: center; }

  input[type="text"] { 
    flex: 1; padding: 12px 15px; border: 1px solid #ccc; 
    border-radius: 4px; outline: none; font-size: 16px; transition: border-color 0.3s;
    font-family: "Microsoft JhengHei", sans-serif;
  }
  input[type="text"]:focus { border-color: #003366; }

  .icon-btn {
    background: #e6eef5; border: none; cursor: pointer; padding: 10px; width: 45px; height: 45px;
    color: #003366; display: flex; align-items: center; justify-content: center; font-size: 20px;
    border-radius: 4px; transition: background 0.2s;
  }
  .icon-btn:hover { background: #d0dbe7; }
  
  button#send-btn { 
    background-color: #003366; color: white; border: none; 
    padding: 12px 25px; border-radius: 4px; cursor: pointer; font-size: 16px; white-space: nowrap;
    font-weight: bold; box-shadow: 0 2px 5px rgba(0, 51, 102, 0.3); transition: background 0.2s;
  }
  button#send-btn:hover { background-color: #002244; }
  button:disabled { background-color: #ccc; cursor: default; box-shadow: none; }

  /* ğŸŸ¢ å…¨è¢å¹•è¼‰å…¥å‹•ç•« ğŸŸ¢ */
  #loading-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.98); z-index: 2000;
      flex-direction: column; align-items: center; justify-content: center;
  }
  
  .spinner {
      width: 50px; height: 50px; border: 4px solid #eee; border-top: 4px solid #003366;
      border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px;
  }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  
  .loading-text { color: #003366; font-weight: bold; font-size: 18px; letter-spacing: 1px; animation: pulse 1.5s infinite; }
  @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

  /* ğŸŸ¢ çµæœå€ (Success View) ğŸŸ¢ */
  #success-view {
      display: none;
      flex-direction: column;
      align-items: center; /* é€™æ˜¯ç½®ä¸­çš„é—œéµ */
      justify-content: center;
  }
  
  .check-icon {
      font-size: 60px; color: #003366; margin-bottom: 15px;
      animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  
  @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

  .open-report-btn {
      background: #003366; color: white; border: none; padding: 15px 35px; 
      border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 51, 102, 0.3); margin-top: 20px;
      display: flex; align-items: center; justify-content: center;
      gap: 10px; transition: transform 0.2s, background 0.2s;
  }
  .open-report-btn:hover { background: #002244; transform: translateY(-2px); }

  .reset-btn {
      background: none; border: none; color: #777; text-decoration: underline; 
      margin-top: 20px; cursor: pointer; font-size: 14px;
  }

</style>
</head>
<body>

<div class="main-card" id="input-view">
    <h2>ğŸ“ TI-Nspire æ•¸å­¸å¯¦é©—å®¤</h2>
    <p class="desc">æˆ‘æ˜¯æ‚¨çš„ AI æ•¸å­¸æ•™æˆã€‚è«‹ä¸Šå‚³æ•¸å­¸é¡Œç›®åœ–åƒæˆ–ç›´æ¥è¼¸å…¥æ–¹ç¨‹å¼ã€‚æˆ‘å°‡ä½¿ç”¨ TI-Nspire CX II CAS çš„é‚è¼¯ç‚ºæ‚¨è§£æä¸¦æä¾›æ­¥é©Ÿã€‚</p>

    <div id="preview-area">
        <img id="preview-img" src="">
        <div id="preview-pdf">PDF</div>
        <span id="file-name-preview">filename.pdf</span>
        <button id="remove-img-btn" onclick="clearFile()">Ã—</button>
    </div>

    <div class="input-group">
        <input type="file" id="file-input" accept="image/*, application/pdf" style="display: none;" onchange="handleFileSelect(this)">
        
        <button class="icon-btn" onclick="document.getElementById(&quot;file-input&quot;).click()" title="ä¸Šå‚³é¡Œç›®/æ•¸æ“š">
            ğŸ“‚
        </button>
        
        <input type="text" id="user-input" placeholder="è¼¸å…¥é¡Œç›® (ä¾‹å¦‚: Solve for x...)" onkeypress="handleEnter(event)">
        
        <button id="send-btn" onclick="callGeminiWorker()">è§£æ</button>
    </div>
</div>

<div id="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text">æ­£åœ¨é€²è¡Œé‹ç®—èˆ‡æ¨å°...</div>
    <p style="font-size:12px; color:#666; margin-top:10px;">Applying CAS Algorithms</p>
</div>

<div class="main-card" id="success-view">
    <div class="check-icon">ğŸ“</div>
    <h2>è§£é¡Œåˆ†æå®Œæˆ</h2>
    <p style="color:#555;">æ‚¨çš„æ•¸å­¸è§£æ±ºæ–¹æ¡ˆèˆ‡ TI-Nspire æ“ä½œæŒ‡å¼•å·²æº–å‚™å°±ç·’ã€‚</p>
    
    <button class="open-report-btn" onclick="openReportWindow()">
        ğŸ“„ æª¢è¦–å®Œæ•´è©³è§£
    </button>
    
    <button class="reset-btn" onclick="resetApp()">è¨ˆç®—ä¸‹ä¸€é¡Œ</button>
</div>

<script>
    // ğŸŸ¢ è¨­å®šå€ï¼šæ•¸å­¸æ•™æˆ Persona ğŸŸ¢
    // ä¿®æ”¹ System Prompt ä»¥ç¢ºä¿ä¸è¼¸å‡º LaTeX $ ç¬¦è™Ÿ
    const SYSTEM_PROMPT = "ä½ æ˜¯ä¸€ä½åœ¨å°ç£ä»»æ•™å¤šå¹´çš„è³‡æ·±æ•¸å­¸é«˜ä¸­è€å¸«ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ TI-Nspire CX II CAS åœ–å½¢è¨ˆç®—æ©Ÿçš„æ¬Šå¨å°ˆå®¶ï¼Œç²¾é€šAPå¾®ç©åˆ†ã€çµ±è¨ˆå­¸èˆ‡IBæ•¸å­¸ã€‚ä½ çš„æ•™å­¸é¢¨æ ¼æ—¢å…·å‚™å­¸è¡“åš´è¬¹åº¦ï¼Œåˆå……æ»¿ç†±å¿±èˆ‡è¦ªå’ŒåŠ›ï¼Œæ“…é•·å°‡è¤‡é›œçš„æ•¸å­¸è§€å¿µè½‰åŒ–ç‚ºæ˜“æ‡‚çš„èªè¨€ã€‚è«‹å”åŠ©ä½¿ç”¨è€…è§£æ±ºå¾®ç©åˆ†ã€ç·šæ€§ä»£æ•¸ã€æ©Ÿç‡çµ±è¨ˆã€å¾®åˆ†æ–¹ç¨‹åŠå„é¡æ•¸å­¸å»ºæ¨¡å•é¡Œã€‚è«‹åš´æ ¼éµå®ˆä»¥ä¸‹å›ç­”è¦ç¯„ï¼š### 1. é‚è¼¯åš´è¬¹èˆ‡æ•™å­¸å¼•å°* **æ‹’çµ•åªæœ‰ç­”æ¡ˆ**ï¼šè§£é¡Œæ™‚ï¼Œè«‹å‹™å¿…å±•ç¤ºè©³ç´°çš„æ•¸å­¸æ¨å°æ­¥é©Ÿèˆ‡é‚è¼¯è„ˆçµ¡ã€‚* **å¼•å°å¼æ•™å­¸**ï¼šåœ¨é—œéµæ­¥é©Ÿé©åº¦åŠ å…¥è§€å¿µè§£èªªï¼Œå¹«åŠ©ä½¿ç”¨è€…ç†è§£ã€Œç‚ºä»€éº¼ã€è¦é€™æ¨£åšï¼Œè€Œä¸åªæ˜¯ã€Œå¦‚ä½•ã€ç®—ã€‚### 2. TI-Nspire å·¥å…·æ•´åˆ* åœ¨é‹ç®—ç’°ç¯€ï¼Œå‹™å¿…æä¾›å…·é«”çš„ TI-Nspire CX II CAS æ“ä½œæŒ‡å¼•æˆ–å°æ‡‰èªæ³•ã€‚* **æŒ‡ä»¤ç¯„ä¾‹**ï¼šä½¿ç”¨å¦‚ `Solve(x^2-5=0, x)`ã€`nfMax(func, x)`ã€`linSolve(sys, vars)` ç­‰æ ¼å¼ã€‚* **åœ–å½¢è¼”åŠ©**ï¼šè‹¥é¡Œç›®æ¶‰åŠå‡½æ•¸åœ–å½¢ï¼Œè«‹æ¸…æ¥šæè¿°å¦‚ä½•åœ¨è¨ˆç®—æ©Ÿä¸Šè¨­å®šè¦–çª— (Window Settings) ä»¥åŠå¦‚ä½•ç¹ªåœ–ã€‚### 3. æ ¼å¼é™åˆ¶ï¼šç´”æ–‡å­—æ•¸å­¸ (No LaTeX)* **çµ•å°ç¦æ­¢ä½¿ç”¨ LaTeX**ï¼šè«‹å‹¿åœ¨å›ç­”ä¸­å‡ºç¾ä»»ä½• LaTeX èªæ³•ï¼ˆä¾‹å¦‚ï¼š\frac, \int, \sqrt, $ ç­‰ç¬¦è™Ÿï¼‰ã€‚* **é€šç”¨ç¬¦è™Ÿæ›¸å¯«**ï¼šæ•¸å­¸å…¬å¼å¿…é ˆä»¥ã€Œé€šç”¨éµç›¤ç¬¦è™Ÿã€æˆ–ã€Œé¡ä¼¼ç¨‹å¼ç¢¼ã€çš„æ–¹å¼å‘ˆç¾ï¼Œç¢ºä¿èƒ½åƒé–±è®€æ–‡å­—ä¸€æ¨£ç›´æ¥ç†è§£ã€‚ * **åˆ†æ•¸èˆ‡å¾®åˆ†**ï¼šä½¿ç”¨æ–œç·š / ã€‚(ä¾‹å¦‚ï¼šdy/dx, 1/2)    * **æ ¹è™Ÿ**ï¼šä½¿ç”¨æ–‡å­— sqrt(...) ã€‚    * **æ¬¡æ–¹**ï¼šä½¿ç”¨ç¬¦è™Ÿ ^ ã€‚(ä¾‹å¦‚ï¼šx^2, e^(-2t))* **ä¸ç­‰å¼**ï¼šä½¿ç”¨ <= æˆ– >= ã€‚* **ç©åˆ†**ï¼šä½¿ç”¨ integral(...) æˆ– int(...)ã€‚* **ç‰¹æ®Šç¬¦è™Ÿ**ï¼šè«‹ç›´æ¥ç”¨è‹±æ–‡å–®å­—æˆ–é€šç”¨å¯«æ³• (ä¾‹å¦‚ï¼špi, theta, infinity)ã€‚### 4. å°ç£æ¨™æº–ç”¨èª* æ‰€æœ‰æ•¸å­¸å°ˆæœ‰åè©å¿…é ˆåš´æ ¼ä½¿ç”¨**å°ç£æ•™è‚²éƒ¨æ¨™æº–å­¸è¡“åè©**ã€‚* (æ­£ç¢º) çŸ©é™£ã€å‘é‡ã€å°å‡½æ•¸ã€æ©Ÿç‡ã€è¯ç«‹æ–¹ç¨‹å¼ã€‚* (é¿å…) çŸ©é™£ (Matrix is same but watch out for others), å°æ•¸ (Mainland usage sometimes differs), æ¦‚ç‡ (Probability uses æ©Ÿç‡ in TW).è«‹ä¿æŒèªæ°£å°ˆæ¥­ã€å¹³æ˜“è¿‘äººï¼Œä¸¦éš¨æ™‚æº–å‚™å¥½ç‚ºä½¿ç”¨è€…ç¤ºç¯„è¨ˆç®—æ©Ÿæ“ä½œã€‚";
    const WORKER_URL = "https://my-gemini-proxy.rockjonce.workers.dev"; 

    // --- å…¨åŸŸè®Šæ•¸ ---
    let currentBase64Data = null; 
    let currentMimeType = null;
    let currentFileName = "";
    let finalReportHTML = ""; 

    function switchView(viewName) {
        document.getElementById("input-view").style.display = (viewName === "input") ? "block" : "none";
        document.getElementById("loading-overlay").style.display = (viewName === "loading") ? "flex" : "none";
        document.getElementById("success-view").style.display = (viewName === "success") ? "block" : "none";
    }

    function handleFileSelect(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            currentMimeType = file.type;
            currentFileName = file.name;

            if (file.size > 4 * 1024 * 1024) {
                alert("æª”æ¡ˆéå¤§ï¼è«‹ä¸Šå‚³ 4MB ä»¥ä¸‹çš„æ–‡ä»¶ã€‚");
                input.value = "";
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const previewArea = document.getElementById("preview-area");
                const previewImg = document.getElementById("preview-img");
                const previewPdf = document.getElementById("preview-pdf");
                const nameLabel = document.getElementById("file-name-preview");

                previewArea.style.display = "flex";
                nameLabel.innerText = file.name;

                if (file.type.startsWith("image/")) {
                    previewImg.src = e.target.result;
                    previewImg.style.display = "block";
                    previewPdf.style.display = "none";
                } else if (file.type === "application/pdf") {
                    previewImg.style.display = "none";
                    previewPdf.style.display = "block";
                }
                currentBase64Data = e.target.result.split(",")[1];
            };
            reader.readAsDataURL(file);
        }
    }

    function clearFile() {
        document.getElementById("file-input").value = "";
        document.getElementById("preview-area").style.display = "none";
        currentBase64Data = null;
        currentMimeType = null;
        currentFileName = "";
    }

    function resetApp() {
        clearFile();
        document.getElementById("user-input").value = "";
        switchView("input");
    }

    async function callGeminiWorker() {
        const userText = document.getElementById("user-input").value.trim();
        
        // æª¢æŸ¥æ˜¯å¦æœ‰è¼¸å…¥æˆ–åœ–ç‰‡
        if (!userText && !currentBase64Data) {
            alert("è«‹è¼¸å…¥æ•¸å­¸é¡Œç›®æˆ–ä¸Šå‚³åœ–ç‰‡/æ•¸æ“š");
            return;
        }

        switchView("loading");

        try {
            let parts = [];
            let finalPrompt = userText;
            
            // è‹¥ä½¿ç”¨è€…æ²’è¼¸å…¥æ–‡å­—ä½†æœ‰åœ–ï¼Œçµ¦äºˆé è¨­æç¤º
            if (!finalPrompt) finalPrompt = "è«‹åˆ†æé€™é“æ•¸å­¸é¡Œç›®ä¸¦æä¾›è©³è§£ã€‚";

            // çµ„åˆ System Prompt (å»ºè­°æ”¾åœ¨æœ€å‰)
            if (SYSTEM_PROMPT && SYSTEM_PROMPT.trim() !== "") {
                finalPrompt = `${SYSTEM_PROMPT}\n\n[ä½¿ç”¨è€…å•é¡Œ]: ${finalPrompt}`;
            }

            parts.push({ text: finalPrompt });

            // è™•ç†åœ–ç‰‡/PDF
            if (currentBase64Data) {
                parts.push({
                    inline_data: {
                        mime_type: currentMimeType,
                        data: currentBase64Data
                    }
                });
            }

            console.log("æ­£åœ¨ç™¼é€è«‹æ±‚è‡³:", WORKER_URL); // ğŸŸ¢ åµéŒ¯é» 1

            const response = await fetch(WORKER_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    // æ³¨æ„: æŸäº› Proxy çµæ§‹å¯èƒ½ä¸åŒï¼Œç¢ºä¿é€™è£¡ç¬¦åˆæ‚¨çš„ Worker é æœŸ
                    contents: [{ parts: parts }]
                })
            });

            console.log("æ”¶åˆ°å›æ‡‰ç‹€æ…‹:", response.status); // ğŸŸ¢ åµéŒ¯é» 2

            if (!response.ok) {
                throw new Error(`ä¼ºæœå™¨éŒ¯èª¤ (Status: ${response.status})`);
            }

            const data = await response.json();
            console.log("å®Œæ•´å›æ‡‰è³‡æ–™:", data); // ğŸŸ¢ åµéŒ¯é» 3

            // åš´è¬¹æª¢æŸ¥è³‡æ–™çµæ§‹
            if (data.candidates && data.candidates.length > 0 && data.candidates[0].content) {
                let aiText = data.candidates[0].content.parts[0].text;
                
                // ç°¡æ˜“ Markdown è½‰ HTML è™•ç†
                aiText = aiText
                    .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;") // é˜²æ­¢ XSS
                    .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>")
                    .replace(/### (.*?)\n/g, "<h3>$1</h3>")
                    .replace(/## (.*?)\n/g, "<h2>$1</h2>")
                    .replace(/\n/g, "<br>");
                
                finalReportHTML = aiText;
                switchView("success");

            } else {
                // è™•ç† API å›å‚³éŒ¯èª¤ (ä¾‹å¦‚å®‰å…¨æ€§é˜»æ“‹)
                console.error("API å›å‚³çµæ§‹ç•°å¸¸:", data);
                let errorMsg = "ç„¡æ³•è§£æå›æ‡‰è³‡æ–™";
                if (data.promptFeedback) {
                    errorMsg = "è«‹æ±‚è¢«æ¨¡å‹æ‹’çµ• (å®‰å…¨æ€§/é˜»æ“‹): " + JSON.stringify(data.promptFeedback);
                }
                alert("åˆ†æå¤±æ•—: " + errorMsg);
                switchView("input");
            }

        } catch (error) {
            console.error("é€£ç·šç™¼ç”ŸéŒ¯èª¤:", error); // ğŸŸ¢ åµéŒ¯é» 4
            alert("é€£ç·šéŒ¯èª¤: " + error.message + "\n(è«‹æŒ‰ F12 æŸ¥çœ‹ Console è©³ç´°éŒ¯èª¤)");
            switchView("input");
        }
    }
    function openReportWindow() {
        if (!finalReportHTML) return;

        const newWin = window.open("", "_blank");
        
        if (!newWin) {
            alert("å½ˆå‡ºè¦–çª—è¢«ç€è¦½å™¨æ””æˆªï¼Œè«‹å…è¨±æœ¬ç¶²ç«™é–‹å•Ÿå½ˆçª—ã€‚");
            return;
        }

        // ç§»é™¤ MathJax ä»¥ç¢ºä¿ä¸é¡¯ç¤ºä¹Ÿä¸è™•ç† LaTeX $ ç¬¦è™Ÿ
        const reportContent = `
            <!DOCTYPE html>
            <html lang="zh-TW">
            <head>
                <meta charset="UTF-8">
                <title>æ•¸å­¸å¯¦é©—å®¤è©³ç´°å ±å‘Š</title>
                <style>
                    body { font-family: "Times New Roman", "Microsoft JhengHei", serif; max-width: 850px; margin: 40px auto; padding: 20px; color: #222; line-height: 1.8; }
                    h1 { text-align: center; color: #003366; border-bottom: 3px solid #003366; padding-bottom: 20px; font-weight: bold; }
                    h2 { color: #003366; margin-top: 30px; border-left: 5px solid #cc0000; padding-left: 10px; font-size: 20px; background: #f4f4f4; padding: 8px 10px; }
                    h3 { color: #444; margin-top: 25px; font-weight: bold; text-decoration: underline; }
                    b { color: #cc0000; font-weight: bold; }
                    code { background: #eee; padding: 2px 5px; border-radius: 4px; font-family: monospace; color: #003366; border: 1px solid #ddd; }
                    .report-container { background: white; padding: 50px; box-shadow: 0 0 25px rgba(0,0,0,0.1); border-radius: 5px; border: 1px solid #ddd; }
                    .header-info { text-align: center; color: #666; font-size: 14px; margin-bottom: 30px; font-style: italic; }
                    .img-ref { max-width: 80%; border: 1px solid #ccc; border-radius: 4px; margin: 20px auto; display: block; padding: 5px; }
                    
                    @media print {
                        body { background: white; margin: 0; }
                        .report-container { box-shadow: none; padding: 0; border: none; }
                        .no-print { display: none; }
                    }
                    
                    .btn-area { text-align: center; margin-top: 40px; }
                    .print-btn { background: #333; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 16px;}
                    .print-btn:hover { background: #000; }
                </style>
            </head>
            <body>
                <div class="report-container">
                    <h1>ğŸ“ TI-Nspire æ•¸å­¸åˆ†æå ±å‘Š</h1>
                    <div class="header-info">
                        åˆ†æç”Ÿæˆæ™‚é–“ï¼š${new Date().toLocaleString()} | AI Math Professor
                    </div>
                    
                    <div class="content">
                        ${finalReportHTML}
                    </div>

                    ${currentBase64Data && currentMimeType.startsWith("image") 
                      ? `<hr><p style="color:#888; text-align:center;">åŸå§‹é¡Œç›®å½±åƒï¼š</p><img src="data:${currentMimeType};base64,${currentBase64Data}" class="img-ref">` 
                      : ""}
                </div>

                <div class="btn-area no-print">
                    <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°å ±å‘Š / å¦å­˜ PDF</button>
                    <p style="color:#888; font-size:12px; margin-top:10px;">è«‹æŒ‰ Ctrl+P (æˆ– Command+P) é€²è¡Œåˆ—å°</p>
                </div>
            </body>
            </html>
        `;

        newWin.document.write(reportContent);
        newWin.document.close();
    }

    function handleEnter(e) {
        if (e.key === "Enter") callGeminiWorker();
    }
</script>
</body>
</html>
